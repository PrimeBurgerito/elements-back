version: 0.2

env:
  variables:
    s3_bucket: codepipeline-eu-north-1-393966113305

phases:
  build:
    commands:
      - echo Build Starting on `date`
      - gradle build -x test
  post_build:
    commands:
      - echo Moving files
      - mv elements-api/build/libs/*.jar elements-api.jar
      - mv elements-auth/build/libs/*.jar elements-auth.jar
      - mv game-session/build/libs/*.jar game-session.jar
      - ls
      - aws s3 cp elements-api.jar s3://$s3_bucket/elements-back/elements-api.jar
      - aws s3 cp elements-auth.jar s3://$s3_bucket/elements-back/elements-auth.jar
      - aws s3 cp game-session.jar s3://$s3_bucket/elements-back/game-session.jar

artifacts:
  files:
    - target/*.jar
  #    - appspec.yml
  discard-paths: yes
